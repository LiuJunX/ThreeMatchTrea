# Honey 蜂蜜

## 概述

Honey（蜂蜜）是一种 Ground 层级的障碍物，位于 Tile 下方。蜂蜜的独特之处在于它具有**蔓延行为**，如果玩家不及时清除，蜂蜜会扩散到相邻格子。

## 基本属性

| 属性 | 值 |
|------|-----|
| GroundType | `Honey` |
| 默认血量 | 1 HP |
| 层级位置 | Ground（Tile 下方） |
| 特殊行为 | 蔓延 |

## 规则

### 消除规则

1. **触发条件**：当蜂蜜上方的 Tile 被消除时（匹配、爆炸、UFO、彩球等）
2. **伤害**：每次消除 Tile，蜂蜜 HP - 1
3. **摧毁**：HP 归零时，蜂蜜被移除，发送 `GroundDestroyedEvent`

### 蔓延规则

> **注意**：蔓延功能为设计预留，当前版本可能尚未实现。

| 属性 | 规则 |
|------|------|
| 触发时机 | 每回合结束时（玩家完成一次移动后） |
| 蔓延方向 | 四方向（上、下、左、右） |
| 蔓延条件 | 目标格子有 Tile 且无 Ground/Cover |
| 蔓延数量 | 每回合最多蔓延 1 格（从所有蜂蜜中随机选择一个） |

```
蔓延流程：

回合结束
    │
    ▼
收集所有蜂蜜位置
    │
    ▼
随机选择一个蜂蜜
    │
    ▼
检查四方向相邻格子
    │
    ├──→ 有空位（有 Tile，无 Ground/Cover）
    │         │
    │         ▼
    │    随机选择一个空位
    │         │
    │         ▼
    │    在该位置生成新蜂蜜
    │
    └──→ 无空位
              │
              ▼
         本回合不蔓延
```

### 不影响的规则

- **匹配检测**：蜂蜜不影响 Tile 的匹配判定
- **Tile 移动**：蜂蜜不阻挡 Tile 的重力下落
- **玩家交换**：蜂蜜不阻止玩家交换上方的 Tile

### 与冰块/果冻的区别

| 特性 | Ice 冰块 | Jelly 果冻 | Honey 蜂蜜 |
|------|----------|-----------|-----------|
| 默认 HP | 1 | 2 | 1 |
| 蔓延行为 | 无 | 无 | **有** |
| 难度定位 | 基础障碍 | 进阶障碍 | 动态障碍 |
| 时间压力 | 无 | 无 | **有** |

## 视觉表现

| 状态 | 描述 |
|------|------|
| 正常 | 金黄色半透明蜂蜜，有流动感 |
| 即将蔓延 | 边缘有气泡/波动动画（预警） |
| 蔓延中 | 蜂蜜流动到相邻格子的动画 |
| 被消除 | 溅射消散动画 |

**视觉建议**：
- 使用金黄色/琥珀色，与冰块（蓝色）和果冻（紫色）区分
- 添加粘稠的流动效果，体现蜂蜜的特性
- 蔓延预警动画帮助玩家提前规划

## 与其他系统的交互

### 炸弹效果

- 炸弹爆炸范围内的蜂蜜会受到伤害
- 大范围炸弹可以有效控制蜂蜜蔓延

### Cover 层级

- 如果同一位置同时存在 Cover 和 Honey：
  - 消除顺序：Cover → Tile → Honey
  - Cover 存在时，Tile 受保护，Honey 不受伤害
- 蜂蜜不会蔓延到有 Cover 的格子

### AI 评估

- AI 会优先选择能够消除蜂蜜的移动（防止蔓延）
- 蜂蜜位置的价值权重最高（时间敏感）
- AI 应该评估蜂蜜的潜在蔓延方向

### 回合系统

- 蜂蜜蔓延在回合结束时触发
- 连锁消除期间不触发蔓延
- 蔓延检查在所有方块落定后执行

## 代码位置

| 文件 | 说明 |
|------|------|
| `src/Match3.Core/Models/Enums/GroundType.cs` | 枚举定义 |
| `src/Match3.Core/Models/Grid/Ground.cs` | 数据结构 |
| `src/Match3.Core/Models/Grid/GroundRules.cs` | 默认血量查表 |
| `src/Match3.Core/Systems/Layers/GroundSystem.cs` | 消除逻辑 |
| `src/Match3.Core/Events/LayerEvents.cs` | GroundDestroyedEvent |
| ~~`src/Match3.Core/Systems/Layers/HoneySpreadSystem.cs`~~ | 蔓延逻辑（待实现） |

## 关卡设计建议

### 难度控制

- 蜂蜜数量决定了时间压力的强度
- 初始蜂蜜位置影响玩家的开局策略
- 步数限制需要考虑蜂蜜蔓延的影响

### 设计模式

| 模式 | 描述 |
|------|------|
| 单源蔓延 | 单个蜂蜜起点，玩家需要阻止扩散 |
| 多源包围 | 多个蜂蜜从棋盘边缘向中心蔓延 |
| 定时炸弹 | 蜂蜜+步数限制，制造紧迫感 |
| 安全岛 | 部分区域用 Cover 保护，不会被蜂蜜侵入 |

### 平衡建议

- 蜂蜜关卡应该给玩家足够的步数来应对蔓延
- 提供大范围消除的机会（炸弹生成条件相对宽松）
- 蔓延速度不宜过快，给玩家思考时间
- 考虑添加"蜂蜜不蔓延"的特殊道具

## 游戏失败条件

当蜂蜜蔓延覆盖整个棋盘时，可以设计为游戏失败条件：

```
蜂蜜覆盖率检查：

蔓延完成后
    │
    ▼
计算蜂蜜覆盖率 = 蜂蜜数量 / 有效格子数量
    │
    ▼
覆盖率 >= 阈值？（如 80%）
    │
    ├──是──→ 游戏失败
    │
    └──否──→ 继续游戏
```

## 相关文档

- [Ground/Cover 层级设计](../04-adr/adr-007-ground-cover-layer.md)
- [Ice 冰块](./ground-ice.md)
